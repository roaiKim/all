{"version":3,"file":"module.js","sourceRoot":"","sources":["../core/module.ts"],"names":[],"mappings":";AAAA,OAAO,EAAE,GAAG,EAAE,MAAM,OAAO,CAAC;AAG5B,OAAO,EAAE,WAAW,EAAE,MAAM,wBAAwB,CAAC;AACrD,OAAO,EAAU,cAAc,EAAE,MAAM,WAAW,CAAC;AAqBnD,MAAM,UAAU,QAAQ,CAA6B,MAAS;IAC1D,IAAM,UAAU,GAAW,MAAM,CAAC,IAAI,CAAC;IACvC,IAAI,CAAC,GAAG,CAAC,KAAK,CAAC,QAAQ,EAAE,CAAC,GAAG,CAAC,UAAU,CAAC,EAAE;QACvC,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,cAAc,CAAC,UAAU,EAAE,MAAM,CAAC,YAAY,EAAE,YAAK,UAAU,YAAS,CAAC,CAAC,CAAC;KACjG;IAED,IAAM,OAAO,GAAQ,EAAE,CAAC;IACxB,OAAO,CAAC,MAAM,CAAC,CAAC,OAAO,CAAC,UAAC,UAAU;QAC/B,IAAM,MAAM,GAAG,MAAM,CAAC,UAAU,CAAC,CAAC;QAClC,IAAM,mBAAmB,GAAG,UAAG,UAAU,cAAI,UAAU,CAAE,CAAC;QAC1D,MAAM,CAAC,UAAU,GAAG,mBAAmB,CAAC;QACxC,OAAO,CAAC,UAAU,CAAC,GAAG;YAAC,iBAAiB;iBAAjB,UAAiB,EAAjB,qBAAiB,EAAjB,IAAiB;gBAAjB,4BAAiB;;YAAoB,OAAA,CAAC,EAAE,IAAI,EAAE,mBAAmB,EAAE,OAAO,SAAA,EAAE,CAAC;QAAxC,CAAwC,CAAC;QAErG,GAAG,CAAC,cAAc,CAAC,mBAAmB,CAAC,GAAG,MAAM,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;IAClE,CAAC,CAAC,CAAC;IAEH,OAAO,IAAI,WAAW,CAAC,MAAM,EAAE,OAAO,CAAC,CAAC;AAC5C,CAAC;AAED,MAAM,UAAgB,aAAa,CAAC,UAAkB,EAAE,OAAsB;IAAE,iBAAiB;SAAjB,UAAiB,EAAjB,qBAAiB,EAAjB,IAAiB;QAAjB,gCAAiB;;;;;;;;oBAEzF,qBAAM,OAAO,wCAAI,OAAO,YAAC;;oBAAzB,SAAyB,CAAC;;;;;;;;;CAIjC;AAED,SAAS,OAAO,CAA6B,MAAS;;IAClD,IAAM,IAAI,GAAa,EAAE,CAAC;;QAC1B,KAA2B,IAAA,KAAA,SAAA,MAAM,CAAC,mBAAmB,CAAC,MAAM,CAAC,cAAc,CAAC,MAAM,CAAC,CAAC,CAAA,gBAAA,4BAAE;YAAjF,IAAM,YAAY,WAAA;YACnB,IAAI,MAAM,CAAC,YAAY,CAAC,YAAY,QAAQ,IAAI,YAAY,KAAK,aAAa,EAAE;gBAC5E,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,CAAC;aAC3B;SACJ;;;;;;;;;IACD,OAAO,IAAI,CAAC;AAChB,CAAC","sourcesContent":["import { app } from \"./app\";\r\nimport { Exception } from \"./Exception\";\r\nimport { Module, ModuleLifecycleListener } from \"./platform/Module\";\r\nimport { ModuleProxy } from \"./platform/ModuleProxy\";\r\nimport { Action, setStateAction } from \"./reducer\";\r\n\r\nexport interface TickIntervalDecoratorFlag {\r\n    tickInterval?: number;\r\n}\r\n\r\nexport interface ErrorListener {\r\n    onError: ErrorHandler;\r\n}\r\n\r\nexport type ActionHandler = (...args: any[]) => any;\r\n\r\nexport type ErrorHandler = (error: Exception) => unknown;\r\n\r\ntype ActionCreator<H> = H extends (...args: infer P) => unknown ? (...args: P) => Action<P> : never;\r\ntype HandlerKeys<H> = { [K in keyof H]: H[K] extends (...args: any[]) => unknown ? K : never }[Exclude<\r\n    keyof H,\r\n    keyof ModuleLifecycleListener | keyof ErrorListener\r\n>];\r\nexport type ActionCreators<H> = { readonly [K in HandlerKeys<H>]: ActionCreator<H[K]> };\r\n\r\nexport function register<M extends Module<any, any>>(module: M): ModuleProxy<M> {\r\n    const moduleName: string = module.name;\r\n    if (!app.store.getState().app[moduleName]) {\r\n        app.store.dispatch(setStateAction(moduleName, module.initialState, `@@${moduleName}/@@init`));\r\n    }\r\n\r\n    const actions: any = {};\r\n    getKeys(module).forEach((actionType) => {\r\n        const method = module[actionType];\r\n        const qualifiedActionType = `${moduleName}/${actionType}`;\r\n        method.actionName = qualifiedActionType;\r\n        actions[actionType] = (...payload: any[]): Action<any[]> => ({ type: qualifiedActionType, payload });\r\n\r\n        app.actionHandlers[qualifiedActionType] = method.bind(module);\r\n    });\r\n\r\n    return new ModuleProxy(module, actions);\r\n}\r\n\r\nexport async function executeAction(actionName: string, handler: ActionHandler, ...payload: any[]) {\r\n    try {\r\n        await handler(...payload);\r\n    } catch (error) {\r\n        //\r\n    }\r\n}\r\n\r\nfunction getKeys<M extends Module<any, any>>(module: M) {\r\n    const keys: string[] = [];\r\n    for (const propertyName of Object.getOwnPropertyNames(Object.getPrototypeOf(module))) {\r\n        if (module[propertyName] instanceof Function && propertyName !== \"constructor\") {\r\n            keys.push(propertyName);\r\n        }\r\n    }\r\n    return keys;\r\n}\r\n"]}